<!-- Container -->
<div class="dynamic-table-container">
    <!-- Loader row -->
    <div class="dynamic-table-loading-row" *ngIf="isLoadingResults">
        <mat-spinner [color]="color"></mat-spinner>
    </div>
    <!-- Table row -->
    <div class="dynamic-table-table-row" *ngIf="!isLoadingResults">
        <!-- Filter -->
        <div class="dynamic-table-filter" *ngIf="filterable">
            <mat-form-field [color]="color">
                <mat-label>{{filterLabel}}</mat-label>
                <input matInput (keyup)="applyFilter($event)" [placeholder]="filterPlaceholder" #filterInput>
            </mat-form-field>
        </div>
        <!-- Table -->
        <div class="dynamic-table-table" [ngClass]="tableClass">
            <!-- Table -->
            <mat-table [dataSource]="dataSource" multiTemplateDataRows cdkDropList cdkDropListOrientation="horizontal"
                (cdkDropListDropped)="drop($event)" matSort [matSortActive]="activeSortField"
                [matSortDirection]="activeSortDirection">

                <!-- Select row column -->
                <ng-container matColumnDef="select" sticky>
                    <mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)"
                            [aria-label]="checkboxLabel(row)">
                        </mat-checkbox>
                    </mat-cell>
                    <mat-footer-cell *matFooterCellDef>
                    </mat-footer-cell>
                </ng-container>

                <!-- Select row count column -->
                <ng-container matColumnDef="selectedCountColumn">
                    <mat-footer-cell *matFooterCellDef>
                        <div class="dynamic-table-row-expandable-content"
                            [@expandRow]="selectableRows ? 'expanded' : 'collapsed'">
                            {{selectedRowCount()}} rows selected
                        </div>
                    </mat-footer-cell>
                </ng-container>

                <!-- Field columns -->
                <ng-container matColumnDef="{{column.name}}" *ngFor="let column of columnConfig">
                    <mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!column.sortable" cdkDrag
                        [cdkDragDisabled]="!column.draggable" class="dynamic-tables-sort-header">
                        <mat-icon cdkDragHandle *ngIf="column.draggable" class="dynamic-table-draghandle-column">
                            drag_handle
                        </mat-icon>
                        {{column.displayName}}
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        {{row[column.name]}}
                    </mat-cell>
                    <mat-footer-cell *matFooterCellDef>
                    </mat-footer-cell>
                </ng-container>

                <!-- Expanded field column -->
                <ng-container matColumnDef="expandableContentColumn">
                    <mat-cell *matCellDef="let row">
                        <div class="dynamic-table-row-expandable-content"
                            [@expandRow]="row == expandedRow ? 'expanded' : 'collapsed'">
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed eu odio purus. Quisque augue
                                lacus, vehicula quis vestibulum blandit, vestibulum ut ante. Ut venenatis metus sed
                                ipsum malesuada feugiat. Nam et quam mollis, porttitor sem eu, auctor lacus. Morbi nec
                                sem vulputate, consectetur ipsum vitae, fringilla risus. Fusce condimentum laoreet
                                consequat. Vestibulum feugiat, mauris pellentesque cursus tempor, augue quam commodo
                                neque, sit amet tristique diam massa nec purus. Maecenas malesuada pretium dui, vitae
                                cursus mi tristique ac. Integer convallis lorem metus, eget aliquet nulla pretium ut.
                                Donec mattis metus dui, sit amet luctus risus interdum nec.</p>
                        </div>
                    </mat-cell>
                </ng-container>

                <!-- Header row definitions -->
                <mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true">
                </mat-header-row>
                <!-- Content row definitions -->
                <mat-row mat-ripple *matRowDef="let row; columns: columnsToDisplay;" class="dynamic-table-row"
                    [class.dynamic-table-row-expanded]="expandedRow === row" (click)="expandRow(row)">
                </mat-row>
                <mat-row *matRowDef="let row; columns: ['expandableContentColumn']"
                    class="dynamic-table-row-expandable">
                </mat-row>
                <!-- Footer row definitions -->
                <mat-footer-row *matFooterRowDef="columnsToDisplay; sticky: true">
                </mat-footer-row>
                <mat-footer-row *matFooterRowDef="['selectedCountColumn']"
                    class="dynamic-table-row dynamic-table-row-expandable" [class.expanded]="selectableRows">
                </mat-footer-row>

                <!-- Row shown when there is no matching data. -->
                <div class="dynamic-table-row-no-data" *matNoDataRow>
                    <div class="mat-cell">No data to display</div>
                </div>

            </mat-table>

            <mat-paginator [pageSizeOptions]="paginationSizeOptions" [pageSize]="paginationSizeDefault"></mat-paginator>
        </div>
    </div>

</div>