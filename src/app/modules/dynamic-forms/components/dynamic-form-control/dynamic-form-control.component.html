<div [formGroup]="form">
  <!-- Form styling -->
  <div *ngIf="isFormFieldControl" class="dynamic-form-control">
    <mat-form-field
      [id]="'form-field-' + control.key"
      [appearance]="appearance"
      [color]="color"
      [floatLabel]="control.floatLabel"
      [ngSwitch]="control.controlType"
    >
      <!-- Label -->
      <mat-label [attr.for]="control.key" class="dynamic-form-control-label">
        {{ control.label }}
      </mat-label>

      <!-- Text -->
      <input
        matInput
        *ngSwitchCase="'text'"
        [formControlName]="control.key"
        [id]="control.key"
        [type]="control.inputType"
        [required]="isRequired"
        class="dynamic-form-control-input"
      />

      <!-- Autocomplete -->
      <input
        matInput
        *ngSwitchCase="'autocomplete'"
        [formControlName]="control.key"
        [id]="control.key"
        [type]="control.inputType"
        [required]="isRequired"
        [matAutocomplete]="autoComp"
        class="dynamic-form-control-input"
      />
      <img
        matSuffix
        *ngIf="selectedAutocompleteOption?.image"
        [alt]="selectedAutocompleteOption?.value"
        [src]="selectedAutocompleteOption?.image"
        width="32"
      />
      <mat-autocomplete
        autoActiveFirstOption
        #autoComp="matAutocomplete"
        [displayWith]="getAutocompleteDisplayValue"
        (optionSelected)="setSelectedAutocompleteOption($event.option.value)"
      >
        <mat-option
          *ngFor="let option of filteredAutocompleteOptions | async"
          [value]="option"
        >
          <div class="dynamic-form-control-autocomplete-option">
            <div
              *ngIf="option.image"
              class="dynamic-form-control-autocomplete-option-img"
            >
              <img [alt]="option.value" [src]="option.image" width="32" />
            </div>
            {{ option.label }}
          </div>
        </mat-option>
      </mat-autocomplete>

      <!-- Text area -->
      <textarea
        matInput
        *ngSwitchCase="'textarea'"
        [formControlName]="control.key"
        [id]="control.key"
        [required]="isRequired"
        class="dynamic-form-control-input"
      ></textarea>

      <!-- Select -->
      <mat-select
        *ngSwitchCase="'dropdown'"
        [formControlName]="control.key"
        [id]="control.key"
        [required]="isRequired"
        class="dynamic-form-control-input"
      >
        <mat-option
          *ngFor="let option of control.options"
          [value]="option.value"
        >
          {{ option.label }}
        </mat-option>
      </mat-select>

      <!-- Date -->
      <input
        matInput
        *ngSwitchCase="'date'"
        [formControlName]="control.key"
        [id]="control.key"
        [matDatepicker]="datePicker"
        [required]="isRequired"
        class="dynamic-form-control-input"
      />
      <mat-datepicker-toggle
        *ngSwitchCase="'date'"
        matSuffix
        [for]="datePicker"
      ></mat-datepicker-toggle>
      <mat-datepicker touchUi #datePicker></mat-datepicker>

      <!-- Date of birth -->
      <input
        matInput
        *ngSwitchCase="'date-of-birth'"
        [formControlName]="control.key"
        [id]="control.key"
        [matDatepicker]="dateOfBirthPicker"
        [required]="isRequired"
        [max]="getMinAgeDate()"
        class="dynamic-form-control-input"
      />
      <mat-datepicker-toggle
        *ngSwitchCase="'date-of-birth'"
        matSuffix
        [for]="dateOfBirthPicker"
      ></mat-datepicker-toggle>
      <mat-datepicker
        touchUi
        #dateOfBirthPicker
        startView="multi-year"
      ></mat-datepicker>

      <!-- Date range -->
      <mat-date-range-input
        *ngSwitchCase="'date-range'"
        [formGroup]="dateRange"
        [rangePicker]="dateRangePicker"
        [disabled]="control.disabled"
        class="dynamic-form-control-input"
      >
        <input
          matStartDate
          placeholder="Start"
          formControlName="start"
          class="dynamic-form-control-input"
          [required]="isRequired"
          (dateChange)="setDateRange()"
        />
        <input
          matEndDate
          placeholder="Eind"
          formControlName="end"
          class="dynamic-form-control-input"
          [required]="isRequired"
          (dateChange)="setDateRange()"
        />
      </mat-date-range-input>
      <mat-datepicker-toggle
        *ngSwitchCase="'date-range'"
        matSuffix
        [for]="dateRangePicker"
      ></mat-datepicker-toggle>
      <mat-date-range-picker touchUi #dateRangePicker></mat-date-range-picker>

      <!-- Chips -->
      <mat-chip-list
        *ngSwitchCase="'chips'"
        [formControlName]="control.key"
        [id]="control.key"
        [required]="isRequired"
        class="dynamic-form-control-input"
        #chipList
      >
        <mat-chip
          *ngFor="let item of control.value"
          [selectable]="control.selectable"
          [removable]="control.removable"
          (removed)="removeFromValue(item)"
          class="dynamic-form-control-chip"
        >
          {{ item }}
          <button
            *ngIf="!control.disabled"
            mat-icon-button
            class="remove-chip-button"
            (click)="removeFromValue(item)"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-chip>
        <input
          #chipInput
          [placeholder]="control.placeholder"
          [matChipInputFor]="chipList"
          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
          [matChipInputAddOnBlur]="control.addOnBlur"
          (matChipInputTokenEnd)="
            addToValue($event.value); chipInput.value = ''
          "
          class="dynamic-form-control-input"
        />
      </mat-chip-list>

      <!-- Error -->
      <mat-error *ngIf="!isValid">
        {{ errorMessage }}
      </mat-error>
    </mat-form-field>
  </div>

  <!-- Non form fields -->
  <div
    *ngIf="!isFormFieldControl"
    class="dynamic-form-control dynamic-form-control-non-form-field"
  >
    <!-- Label -->
    <label
      class="dynamic-form-control-label"
      [class.show-error]="!isValid && isTouched"
      [attr.for]="control.key"
    >
      {{ control.label }}
      <span
        style="display: inline"
        *ngIf="isRequired"
        [class.mat-error]="!isValid && isTouched"
        >*</span
      >
    </label>

    <div [ngSwitch]="control.controlType" class="no-form-field">
      <!-- Radio -->
      <mat-radio-group
        *ngSwitchCase="'radio'"
        [id]="control.key"
        [color]="color"
        [formControlName]="control.key"
        [required]="isRequired"
        (change)="markAsTouched()"
      >
        <mat-radio-button
          *ngFor="let option of control.options"
          [value]="option.value"
        >
          {{ option.label }}
        </mat-radio-button>
      </mat-radio-group>

      <!-- Checkbox -->
      <mat-checkbox
        *ngSwitchCase="'checkbox'"
        [id]="control.key"
        [color]="color"
        [formControlName]="control.key"
        [labelPosition]="control.labelPosition"
        [indeterminate]="control.indeterminate"
        [required]="isRequired"
        (change)="markAsTouched()"
      >
        {{ control.placeholder }}
      </mat-checkbox>

      <!-- Slide -->
      <mat-slide-toggle
        *ngSwitchCase="'slide'"
        [id]="control.key"
        [color]="color"
        [formControlName]="control.key"
        [labelPosition]="control.labelPosition"
        [checked]="control.value"
        [required]="isRequired"
        (change)="markAsTouched()"
      >
        {{ control.placeholder }}
      </mat-slide-toggle>

      <!-- Error -->
      <mat-error class="form-control-error">
        <span
          [@errorAnimation]
          *ngIf="!isValid && isTouched"
          class="error-message"
        >
          {{ errorMessage }}
        </span>
      </mat-error>
    </div>
  </div>
</div>
